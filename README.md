# x7mall
项目描述：

x7mall是一个基于SOA架构，SSM整合框架的综合性B2C平台，会员可以在平台浏览商品、下订单，以及参加各种活动。

软件架构：Spring+Springmvc+MyBatis+Redis+Solr+MySQL

系统描述：

后台管理系统（manager）：管理商品、订单、类目、商品规格属性、用户管理以及内容发布等功能。

前台系统（content）：用户可以在前台系统中进行注册、登录、浏览商品、首页、下单等操作。

购物车系统（cart）：用户可以在该系统中查询修改购物车的商品。

订单系统（order）：提供下单、查询订单、修改订单状态、定时处理订单。

搜索系统（search）：提供商品的搜索功能。

单点登录系统（sso）：为多个系统之间提供用户登录凭证以及查询登录用户的信息。

运用技术：

1.使用dubbo，因为使用RPC协议进行远程调用，是直接使用socket通信，传输效率高，并且可以统计出系统之间的调用关系、调用次数。

2.使用zookeeper，因为它适合作为Dubbo服务的注册中心。注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小。

3.使用逆向工程和mybatis的分页插件PageHelper，因为逆向工程生成的代码是不支持分页处理的，提高了开发效率。

4.使用FastDFS作为分布式文件系统，搭建一套高性能的文件服务器集群提供文件上传、下载等服务，存储空间可以横向扩展，实现了服务器的高可用，支持每个节点有备份机。

5.使用Nginx。实现反向代理，当多个域名指向同一台Nginx服务器时，用户访问不同域名会显示不同网页内容。实现负载均衡，可以根据服务器的实际情况调整服务器权重。实现主备，keepalived检测web服务器的状态，防止单点故障。

6.使用KindEditor作为富文本编辑器。

7.使用Redis集群，用于添加缓存，减少查询数据库的压力，解决高并发问题。

8.使用SolrCloud和中文分析器IKAnalyzer，用于实现搜索功能，快速高效。

9.使用ActiveMQ发送接收消息，通过消息队列实现商品同步。

10.使用FreeMarker实现网页静态化，提高用户访问速度。

11.使用Redis模拟Session，搭建单点登录系统，将主要的登录映射到其他应用中用于同一个用户的登录，实现Session的统一管理。

12.使用Jsonp解决JS的跨域问题，因为JS可以跨域加载JS文件，使JS的这个特性绕过跨域请求。

13.使用MyCat，实现数据分片、数据库读写分离，解决海量数据问题。

电商活动倒计时方案：

1、确定一个基准时间。可以使用一个sql语句从数据库中取出一个当前时间。SELECT NOW()；

2、活动开始的时间是固定的。

3、使用活动开始时间-基准时间可以计算出一个秒为单位的数值。

4、在Redis中设置一个key（活动开始标识）。设置key的过期时间为第三步计算出来的时间。

5、展示页面的时候取出key的有效时间。TTL命令。使用JS倒计时。

6、一旦活动开始的key失效，说明活动开始。

7、需要在活动的逻辑中，先判断活动是否开始。

秒杀方案：

1、把商品的数量放到Redis中。

2、秒杀时使用decr命令对商品数量减一。如果不是负数说明抢到。

3、一旦返回数值变为0说明商品已售完。

部署分析

manager

manager-web

content

portal-web

search

search-web

item-web

sso

sso-web

cart

cart-web

order

order-web

需要26台服务器。				26

Mysql							    2

Solr								  7

Redis							    6

图片服务器					  	2

Nginx							    2

注册中心					     3

Activemq							2

需要26台服务器。				24

共需要50台服务器。

搭建伪分布式服务器规划

项目						服务器数量						虚拟机			

Mysql							    2              1

Solr								  7              1

Redis							    6              1

图片服务器					  	2              1

Nginx							    2              1

注册中心					     3              1

Activemq							2              1

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

manager		    8080

content		    8081

search			  8082

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	1

sso			      8080

cart			    8081

order			    8082

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	1

manager-web  	8080

portal-web		8081

search-web		8082

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	1

item-web		  8080

sso-web		    8081

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	1

cart-web	   	8080

order-web		  8081

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	1

共需12台服务器。
